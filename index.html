<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>もちもちの子の大冒険</title>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #e0f7fa; } /* 空の色 */
        h1 { color: #6495ed; animation: bounce 1s infinite alternate; }
        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-20px); } }
        
        /* 地面（エリア）の設定 */
        #stage {
            width: 100vw; height: 100vh;
            background-color: #8bc34a; /* 草原の色 */
            background-image: radial-gradient(#9ccc65 20%, transparent 20%), 
                              radial-gradient(#9ccc65 20%, transparent 20%);
            background-size: 50px 50px;
            background-position: 0 0, 25px 25px;
        }

        /* キャラクターの表示サイズ */
        #player {
            width: 10%; height: 10%;
            position: absolute; top: 0; left: 0;
            --poster-color: transparent;
        }
    </style>
</head>
<body>

    <h1>Hello!<br> Welcome to AOKUJILab.</h1>
<div id="stage">
    <model-viewer id="player"
        src="first_kemono_animation.glb" 
        autoplay
        animation-name="idle"
        shadow-intensity="1"
        environment-image="neutral"
        camera-controls
        touch-action="none">
    </model-viewer>
</div>

<script>
    const model = document.querySelector('#player');
    let posX = 0, posZ = 0, rotation = 180;
    const speed = 3; // 移動速度
    const keys = {};

    // キー入力の状態を記録
    window.addEventListener('keydown', e => keys[e.key] = true);
    window.addEventListener('keyup', e => {
        keys[e.key] = false;
        model.animationName = "Idle"; // キーを離したら待機
    });

    function update() {
        let moving = false;
        
        // 十字キーまたはWASD
        if (keys['ArrowUp'] || keys['w']) { posZ -= speed; moving = true; }
        if (keys['ArrowDown'] || keys['s']) { posZ += speed; moving = true; }
        if (keys['ArrowLeft'] || keys['a']) { posX -= 0; rotation += (speed*2); moving = true; }
        if (keys['ArrowRight'] || keys['d']) { posX += 0; rotation -= (speed*2); moving = true; }

        if (moving) {
            model.animationName = "walk"; // 動いている時は歩行アニメ
            // モデルの位置を移動（CSSのtransformを使用）
            model.style.transform = `translate(${posX}px, ${posZ}px)`;
            // モデルの向きを回転（model-viewerの属性を使用）
            model.orientation = `0deg 0deg ${rotation}deg`;
        }

        requestAnimationFrame(update);
    }
    update();
</script>

</body>
</html>
